
<div id="result" style="display: none;">{{result}}</div>
<head>
    <title>Search Result</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0,user-scalable=0"/>
</head>
<script>
    function parseResult(){
        ServerResult = document.getElementById("result").innerHTML;
        ServerResult = window.atob(ServerResult);
        a = JSON.parse(ServerResult);
        t = 0;
        a1 ='<div class="mdui-panel" mdui-panel><div class="mdui-panel-item mdui-panel-item-open"><div class="mdui-panel-item-header">其他结果</div><div class="mdui-panel-item-body"><p>';
        a2 = '</p></div></div></div>';
        banner = "";
        for(var item in a){
            banner += item+" : "+a[item]+"  ";
            if(t===0){
                SubPlayer(item);
            }else{
                
            }
            t+=1;
        }
        document.getElementById("result-banner").innerHTML = a1+banner+a2;
    }

    function SubPlayer(item){
        //https://player.bilibili.com/player.html?bvid={bv}&high_quality=1&danmaku=0&t=
        p = item.split(",")[0].split("-")[1];
        bv = item.split(",")[0].split("-")[0];
        if(p===undefined){
            p = "1";
            bv = item.split(",")[0];
        }
        start_progress = parseInt(item.split(",")[1])*1000;
        url = "https://player.bilibili.com/player.html?bvid=" + bv +"&p="+p+ "&high_quality=1&danmaku=0&t="+item.split(",")[1];
        document.getElementById("player").innerHTML = "<iframe src='"+url+"' width='100%' height='100%' frameborder='0' scrolling='no'></iframe>";
        result = "最准确链接在"+item.split(",")[0] +"(- 后的代表分P数目)的"+item.split(",")[1] + '秒<br> 由于B站外链播放器版本较旧。移动端建议跳转主站以获得更好的体验 <br><div class="btn-group" role="group" aria-label="Basic example"><button type="button" class="btn btn-info">点此跳转主站</button><button type="button" class="btn btn-primary">再搜一个</button></div>'
        document.getElementById("best-result-banner").innerHTML = result;
    }

    function GetScreenShot(bv,p,time){
        //Get Cid
        Video_info = "https://api.bilibili.com/x/web-interface/view?bvid="+bv
        Info = new XMLHttpRequest();
        Info.open("GET",Video_info,false);
        Info.send(null);
        cid = JSON.parse(Info.responseText)["data"][parseInt(p)-1]["cid"];
        Vid_url = "https://api.bilibili.com/x/player/videoshot?cid="+cid+"&bvid="+bv+"&index=1"
        Vid = new XMLHttpRequest();
        Vid.open("GET",Vid_url,false);
        Vid.send(null);
        Vid_url = JSON.parse(Vid.responseText)["data"];
        for(var t in Vid_url["index"]){
            if (parseInt(Vid_url["index"][t]) <= parseInt(time)&& parseInt(Vid_url["index"][t+1]) > parseInt(time)){
                //先取整,再取余
                parseInt(t)
                break;
            }
        }
    }
</script>

<body onload="parseResult()">
    <div id="best-result-banner"></div>
    <div id="player"></div>
    <div id="result-banner"></div>
    
</body>
